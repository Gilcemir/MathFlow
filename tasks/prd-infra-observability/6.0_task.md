---
status: pending
parallelizable: false
blocked_by: ["5.0"]
---

<task_context>
<domain>infra/automation</domain>
<type>implementation</type>
<scope>developer_experience</scope>
<complexity>medium</complexity>
<dependencies>make</dependencies>
<unblocks></unblocks>
</task_context>

# Tarefa 6.0: Makefile + README + Testes E2E

## Vis√£o Geral

Criar Makefile com comandos √∫teis, atualizar README completo com documenta√ß√£o do projeto, e executar testes end-to-end para validar toda a stack. Esta √© a tarefa final de automa√ß√£o e valida√ß√£o.

## Contexto da Tech Spec

**Refer√™ncia:** Se√ß√£o 12 da Tech Spec - Makefile - Comandos √öteis

**Comandos necess√°rios:**
- `make help` - Lista todos os comandos
- `make build` - Compila aplica√ß√£o
- `make run` - Executa localmente
- `make test` - Executa testes
- `make docker-infra-up/down` - Gerencia apenas infra
- `make docker-up/down` - Gerencia app + infra
- `make docker-logs` - Visualiza logs
- `make clean` - Limpa arquivos de build

## Requisitos

- [ ] Makefile criado na raiz do projeto
- [ ] Comando `help` com documenta√ß√£o
- [ ] Comandos de build, run, test, clean
- [ ] Comandos Docker (up, down, logs)
- [ ] Targets `.PHONY` configurados
- [ ] README atualizado com documenta√ß√£o completa
- [ ] Testes E2E executados e validados
- [ ] Toda a stack funcional

## Subtarefas

### 12.1: Criar Makefile

**A√ß√£o:** Criar Makefile com todos os comandos

**Arquivo:** `Makefile` (raiz do projeto)

**Conte√∫do:**
```makefile
.PHONY: help build run test docker-infra-up docker-infra-down docker-up docker-down docker-logs docker-restart clean

# Default target
help:
	@echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
	@echo "‚ïë              MathFlow - Comandos Dispon√≠veis               ‚ïë"
	@echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
	@echo ""
	@echo "üì¶ Build & Run:"
	@echo "  make build              - Compila a aplica√ß√£o"
	@echo "  make run                - Executa a aplica√ß√£o localmente"
	@echo "  make test               - Executa testes"
	@echo "  make clean              - Limpa arquivos de build"
	@echo ""
	@echo "üê≥ Docker - Infraestrutura:"
	@echo "  make docker-infra-up    - Sobe apenas infraestrutura (Postgres, OTEL, Grafana, etc)"
	@echo "  make docker-infra-down  - Para infraestrutura"
	@echo ""
	@echo "üê≥ Docker - Aplica√ß√£o Completa:"
	@echo "  make docker-up          - Sobe aplica√ß√£o + infraestrutura"
	@echo "  make docker-down        - Para tudo"
	@echo "  make docker-restart     - Reinicia aplica√ß√£o"
	@echo "  make docker-logs        - Exibe logs dos containers"
	@echo ""
	@echo "üîç Acesso aos Servi√ßos:"
	@echo "  Aplica√ß√£o:  http://localhost:5124"
	@echo "  Grafana:    http://localhost:3000 (admin/admin)"
	@echo "  Prometheus: http://localhost:9090"
	@echo "  Loki:       http://localhost:3100/ready"
	@echo ""

# ============================================
# Build & Run
# ============================================

build:
	@echo "üî® Compilando aplica√ß√£o..."
	cd src/MathFlow && dotnet build

run:
	@echo "üöÄ Executando aplica√ß√£o localmente..."
	@echo "üìç Acesse: http://localhost:5124"
	cd src/MathFlow && dotnet run

test:
	@echo "üß™ Executando testes..."
	dotnet test

clean:
	@echo "üßπ Limpando arquivos de build..."
	find . -type d \( -name "bin" -o -name "obj" \) -exec rm -rf {} +
	@echo "‚úÖ Limpeza conclu√≠da"

# ============================================
# Docker - Infraestrutura
# ============================================

docker-infra-up:
	@echo "üê≥ Subindo infraestrutura (Postgres, OTEL, Loki, Prometheus, Grafana)..."
	docker compose -f docker-compose.infra.yml up -d
	@echo "‚úÖ Infraestrutura iniciada"
	@echo "üìç Grafana: http://localhost:3000 (admin/admin)"
	@echo "üìç Prometheus: http://localhost:9090"

docker-infra-down:
	@echo "üõë Parando infraestrutura..."
	docker compose -f docker-compose.infra.yml down
	@echo "‚úÖ Infraestrutura parada"

# ============================================
# Docker - Aplica√ß√£o Completa
# ============================================

docker-up:
	@echo "üê≥ Subindo aplica√ß√£o + infraestrutura..."
	docker compose up --build -d
	@echo "‚úÖ Stack completa iniciada"
	@echo "üìç Aplica√ß√£o: http://localhost:5124"
	@echo "üìç Grafana: http://localhost:3000 (admin/admin)"
	@echo "üìç Prometheus: http://localhost:9090"

docker-down:
	@echo "üõë Parando tudo..."
	docker compose down
	@echo "‚úÖ Stack parada"

docker-restart:
	@echo "üîÑ Reiniciando aplica√ß√£o..."
	docker compose restart app
	@echo "‚úÖ Aplica√ß√£o reiniciada"

docker-logs:
	@echo "üìã Exibindo logs (Ctrl+C para sair)..."
	docker compose logs -f

# ============================================
# Aliases √∫teis
# ============================================

up: docker-up
down: docker-down
logs: docker-logs
restart: docker-restart
```

**Valida√ß√£o:**
- [ ] Arquivo criado na raiz
- [ ] Sintaxe Makefile correta

### 12.2: Testar Comando help

**A√ß√£o:** Testar comando help

**Comandos:**
```bash
cd /Users/educbank/Documents/personal_workspace/MathFlow
make help
```

**Valida√ß√£o:**
- [ ] Comando executa sem erros
- [ ] Help exibe todos os comandos
- [ ] Formata√ß√£o leg√≠vel

### 12.3: Testar Comandos de Build

**A√ß√£o:** Testar comandos build, run, clean

**Comandos:**
```bash
# Build
make build

# Clean
make clean

# Run (testar brevemente e cancelar com Ctrl+C)
make run
```

**Valida√ß√£o:**
- [ ] `make build` compila aplica√ß√£o
- [ ] `make clean` remove bin/obj
- [ ] `make run` executa aplica√ß√£o

### 12.4: Testar Comandos Docker (Ap√≥s Tarefa 9.0)

**A√ß√£o:** Testar comandos Docker

**Comandos:**
```bash
# Subir infra
make docker-infra-up

# Verificar status
docker ps

# Ver logs
make docker-logs

# Parar
make docker-infra-down
```

**Valida√ß√£o:**
- [ ] `make docker-infra-up` sobe containers
- [ ] `make docker-logs` exibe logs
- [ ] `make docker-infra-down` para containers

### 6.5: Atualizar README

**A√ß√£o:** Criar README completo com toda a documenta√ß√£o

**Arquivo:** `README.md`

**Se√ß√µes necess√°rias:**
1. T√≠tulo e descri√ß√£o do projeto
2. Estrutura de pastas
3. Pr√©-requisitos
4. Como executar (com Makefile)
5. Arquitetura e observabilidade
6. Acesso aos servi√ßos
7. Troubleshooting
8. Contribuindo

**Valida√ß√£o:**
- [ ] README criado/atualizado
- [ ] Todas as se√ß√µes presentes
- [ ] Comandos Makefile documentados
- [ ] URLs de acesso documentadas

### 6.6: Testes End-to-End

**A√ß√£o:** Executar testes completos da stack

**Comandos:**
```bash
# 1. Subir stack completa
make docker-up

# 2. Aguardar inicializa√ß√£o (30s)
sleep 30

# 3. Testar aplica√ß√£o
curl http://localhost:5124
# Deve retornar HTML da p√°gina

# 4. Testar Grafana
curl http://localhost:3000
# Deve retornar p√°gina de login

# 5. Testar Prometheus
curl http://localhost:9090/-/ready
# Deve retornar "Prometheus is Ready"

# 6. Testar Loki
curl http://localhost:3100/ready
# Deve retornar "ready"

# 7. Verificar logs no Grafana
# Acessar http://localhost:3000 (admin/admin)
# Ir em Explore > Loki
# Buscar logs da aplica√ß√£o

# 8. Verificar m√©tricas no Prometheus
# Acessar http://localhost:9090
# Buscar m√©tricas: http_server_request_duration_seconds

# 9. Testar convers√£o de documentos
# Upload de arquivo .docx via UI
# Verificar convers√£o funciona

# 10. Parar stack
make docker-down
```

**Valida√ß√£o:**
- [ ] Stack sobe sem erros
- [ ] Aplica√ß√£o responde
- [ ] Grafana acess√≠vel
- [ ] Prometheus acess√≠vel
- [ ] Loki acess√≠vel
- [ ] Logs aparecem no Grafana
- [ ] M√©tricas aparecem no Prometheus
- [ ] Convers√£o de documentos funciona

## Sequenciamento

- **Bloqueado por:** 5.0 (docker-compose completo)
- **Desbloqueia:** Nenhum (tarefa final)
- **Paraleliz√°vel:** N√£o (valida√ß√£o final)

## Crit√©rios de Aceita√ß√£o

‚úÖ **Makefile criado:**
- Arquivo na raiz do projeto
- Sintaxe correta

‚úÖ **Comandos funcionais:**
- `make help` exibe documenta√ß√£o
- `make build` compila
- `make run` executa
- `make test` roda testes
- `make clean` limpa build
- Comandos Docker funcionam

‚úÖ **README completo:**
- Todas as se√ß√µes presentes
- Comandos documentados
- URLs de acesso documentadas
- Troubleshooting presente

‚úÖ **Testes E2E:**
- Stack completa sobe sem erros
- Todos os servi√ßos acess√≠veis
- Telemetria funcionando
- Convers√£o de documentos funciona

‚úÖ **Developer Experience:**
- Help bem formatado
- Mensagens informativas
- Aliases √∫teis (up, down, logs)

## Riscos e Mitiga√ß√µes

| Risco | Probabilidade | Impacto | Mitiga√ß√£o |
|-------|---------------|---------|-----------|
| Sintaxe Makefile incorreta | Baixa | M√©dio | Testar cada comando |
| Caminhos incorretos | Baixa | M√©dio | Usar caminhos relativos |
| Make n√£o instalado | Baixa | Baixo | Documentar no README |

## Notas de Implementa√ß√£o

- **Tempo estimado:** 4-5 horas
- **Complexidade:** M√©dia
- **Depend√™ncias:** Make instalado, stack completa funcional
- **Teste cr√≠tico:** Testes E2E devem passar completamente

## Refer√™ncias

- [GNU Make Manual](https://www.gnu.org/software/make/manual/make.html)
- [Makefile Best Practices](https://makefiletutorial.com/)

## Checklist Final

- [ ] Makefile criado na raiz
- [ ] Comando `help` funcional
- [ ] Comandos de build testados
- [ ] Comandos Docker testados
- [ ] Aliases configurados
- [ ] README atualizado completamente
- [ ] Testes E2E executados
- [ ] Stack completa validada
- [ ] Grafana exibe logs e m√©tricas
- [ ] Convers√£o de documentos funciona
- [ ] Tarefa marcada como completa no `tasks.md`
