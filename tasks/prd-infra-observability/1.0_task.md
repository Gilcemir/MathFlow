---
status: pending
parallelizable: false
blocked_by: []
---

<task_context>
<domain>infra/structure</domain>
<type>refactoring</type>
<scope>project_structure</scope>
<complexity>medium</complexity>
<dependencies>filesystem</dependencies>
<unblocks>2.0,3.0,4.0,5.0,6.0</unblocks>
</task_context>

# Tarefa 1.0: Reestruturar Pastas e Criar Estrutura de Testes

## Visão Geral

Reorganizar a estrutura de pastas do projeto MathFlow seguindo padrões .NET modernos, separando código-fonte (`src/`), testes (`tests/`) e infraestrutura Docker (`docker/`). Além disso, criar a estrutura básica dos projetos de teste. Esta é a tarefa base que desbloqueia todas as outras.

## Contexto da Tech Spec

**Referência:** Seção 2 da Tech Spec - Estrutura de Pastas Detalhada

**Estrutura Alvo:**
```
MathFlow/
├── src/
│   └── MathFlow/              # Todo código da aplicação
├── tests/
│   ├── MathFlow.UnitTests/
│   └── MathFlow.IntegrationTests/
├── docker/
│   ├── app/
│   └── infra/
│       ├── grafana/
│       ├── loki/
│       ├── prometheus/
│       └── otel/
├── docker-compose.yml
├── docker-compose.infra.yml
├── Makefile
├── .env.example
└── README.md
```

## Requisitos

- [ ] Criar estrutura de diretórios `src/`, `tests/`, `docker/`
- [ ] Mover todos os arquivos da aplicação para `src/MathFlow/`
- [ ] Preservar estrutura interna (Pages, Services, Infrastructure, wwwroot, etc.)
- [ ] Criar projetos de teste (`MathFlow.UnitTests`, `MathFlow.IntegrationTests`)
- [ ] Configurar referências entre projetos
- [ ] Aplicação deve compilar após movimentação
- [ ] Aplicação deve executar corretamente após movimentação
- [ ] Git history preservado (usar `git mv` quando possível)

## Subtarefas

### 1.1: Criar Estrutura de Diretórios

**Ação:** Criar toda a estrutura de pastas necessária

**Comandos:**
```bash
cd /Users/educbank/Documents/personal_workspace/MathFlow

# Criar estrutura principal
mkdir -p src/MathFlow
mkdir -p tests/MathFlow.UnitTests
mkdir -p tests/MathFlow.IntegrationTests
mkdir -p docker/app
mkdir -p docker/infra/grafana/provisioning/datasources
mkdir -p docker/infra/loki
mkdir -p docker/infra/prometheus
mkdir -p docker/infra/otel
```

**Validação:**
- [ ] Todas as pastas criadas
- [ ] Estrutura visível no explorador de arquivos

### 1.2: Mover Arquivos da Aplicação

**Ação:** Mover todos os arquivos do projeto para `src/MathFlow/`

**Arquivos a mover:**
- `Pages/` → `src/MathFlow/Pages/`
- `Services/` → `src/MathFlow/Services/`
- `Infrastructure/` → `src/MathFlow/Infrastructure/`
- `Shared/` → `src/MathFlow/Shared/`
- `wwwroot/` → `src/MathFlow/wwwroot/`
- `Properties/` → `src/MathFlow/Properties/`
- `Program.cs` → `src/MathFlow/Program.cs`
- `MathFlow.csproj` → `src/MathFlow/MathFlow.csproj`
- `appsettings.json` → `src/MathFlow/appsettings.json`
- `appsettings.Development.json` → `src/MathFlow/appsettings.Development.json`

**Comandos:**
```bash
# Usar git mv para preservar histórico
git mv Pages src/MathFlow/
git mv Services src/MathFlow/
git mv Infrastructure src/MathFlow/
git mv Shared src/MathFlow/
git mv wwwroot src/MathFlow/
git mv Properties src/MathFlow/
git mv Program.cs src/MathFlow/
git mv MathFlow.csproj src/MathFlow/
git mv appsettings.json src/MathFlow/
git mv appsettings.Development.json src/MathFlow/
```

**Validação:**
- [ ] Todos os arquivos movidos
- [ ] Raiz do projeto limpa (apenas pastas `src/`, `tests/`, `docker/`, `.git/`, etc.)

### 1.3: Atualizar Referências no .csproj

**Ação:** Verificar se caminhos relativos no `.csproj` ainda funcionam

**Arquivo:** `src/MathFlow/MathFlow.csproj`

**Verificação:**
Os caminhos no `.csproj` são relativos ao arquivo, então devem continuar funcionando:
```xml
<None Update="Infrastructure\Converters\Scripts\**\*.js">
```

**Validação:**
- [ ] Caminhos relativos corretos
- [ ] Nenhuma mudança necessária no `.csproj` (caminhos já são relativos)

### 1.4: Testar Compilação

**Ação:** Compilar projeto e verificar erros

**Comandos:**
```bash
cd src/MathFlow
dotnet restore
dotnet build
```

**Validação:**
- [ ] `dotnet restore` executa sem erros
- [ ] `dotnet build` executa sem erros
- [ ] Nenhum warning crítico

### 1.5: Testar Execução

**Ação:** Executar aplicação e verificar funcionamento

**Comandos:**
```bash
cd src/MathFlow
dotnet run
```

**Validação:**
- [ ] Aplicação inicia sem erros
- [ ] Porta 5124 acessível
- [ ] Scripts Node.js carregam corretamente
- [ ] Páginas Razor renderizam
- [ ] Conversão de documentos funciona (teste manual)

### 1.6: Criar Projetos de Teste

**Ação:** Criar estrutura básica dos projetos de teste

**Comandos:**
```bash
# Criar projeto de testes unitários
cd tests/MathFlow.UnitTests
dotnet new xunit
dotnet add reference ../../src/MathFlow/MathFlow.csproj

# Criar projeto de testes de integração
cd ../MathFlow.IntegrationTests
dotnet new xunit
dotnet add reference ../../src/MathFlow/MathFlow.csproj
dotnet add package Microsoft.AspNetCore.Mvc.Testing
```

**Validação:**
- [ ] Projetos criados
- [ ] Referências configuradas
- [ ] `dotnet test` executa (sem testes ainda)

### 1.7: Commit das Mudanças

**Ação:** Commitar reestruturação

**Comandos:**
```bash
git add .
git commit -m "refactor: reorganize project structure with src/, tests/, and docker/ folders"
```

**Validação:**
- [ ] Commit criado
- [ ] Histórico preservado (git mv)

## Sequenciamento

- **Bloqueado por:** Nenhum (tarefa inicial)
- **Desbloqueia:** 2.0, 3.0, 4.0 (todas as outras tarefas)
- **Paralelizável:** Não (base para tudo)

## Critérios de Aceitação

✅ **Estrutura criada:**
- Pastas `src/`, `tests/`, `docker/` existem
- Subpastas corretas dentro de cada uma

✅ **Código movido:**
- Todo código da aplicação em `src/MathFlow/`
- Raiz do projeto organizada

✅ **Funcionalidade preservada:**
- `dotnet build` sem erros
- `dotnet run` executa aplicação
- Conversão de documentos funciona

✅ **Projetos de teste:**
- `MathFlow.UnitTests.csproj` criado
- `MathFlow.IntegrationTests.csproj` criado
- Referências configuradas
- `dotnet test` executa

✅ **Git limpo:**
- Histórico preservado
- Commit descritivo criado

## Riscos e Mitigações

| Risco | Probabilidade | Impacto | Mitigação |
|-------|---------------|---------|-----------|
| Caminhos quebrados no .csproj | Baixa | Alto | Caminhos são relativos, devem funcionar |
| Node.js scripts não encontrados | Média | Alto | Testar execução completa após movimentação |
| Git history perdido | Baixa | Médio | Usar `git mv` em vez de `mv` |

## Notas de Implementação

- **Tempo estimado:** 3-4 horas
- **Prioridade:** CRÍTICA (bloqueia tudo)
- **Rollback:** Se algo der errado, `git reset --hard` antes do commit

## Checklist Final

- [ ] Estrutura de pastas criada
- [ ] Arquivos movidos com `git mv`
- [ ] Projetos de teste criados
- [ ] Referências configuradas
- [ ] Compilação bem-sucedida
- [ ] Execução bem-sucedida
- [ ] Conversão de documentos testada
- [ ] `dotnet test` executa
- [ ] Commit realizado
- [ ] Tarefa marcada como completa no `tasks.md`
