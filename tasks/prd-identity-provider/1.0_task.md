---
status: completed
parallelizable: false
blocked_by: []
---

<task_context>
<domain>backend/infra</domain>
<type>implementation</type>
<scope>foundation</scope>
<complexity>low</complexity>
<dependencies>none</dependencies>
<unblocks>2.0</unblocks>
</task_context>

# Tarefa 1.0: Setup Inicial e Estrutura de Pastas

## Visão Geral

Criar a estrutura de pastas necessária para o Identity Provider seguindo a arquitetura definida na Tech Spec. Esta tarefa estabelece a fundação organizacional do projeto, preparando o terreno para todas as implementações subsequentes.

## Contexto da Tech Spec

**Referência:** Seção 2 da Tech Spec - Estrutura de Pastas Detalhada

- Arquitetura monolítica com pastas organizadas (Domain/Application/Infrastructure)
- Identity Server localizado em `Infrastructure/IdentityServer`
- Separação clara entre camadas de domínio, aplicação e infraestrutura
- Estrutura de testes espelhando a estrutura de produção

## Requisitos

- [ ] Criar estrutura de pastas Domain/Application/Infrastructure
- [ ] Criar subpastas para IdentityServer
- [ ] Criar estrutura de testes (Unit e Integration)
- [ ] Mover páginas existentes para Pages/Public
- [ ] Validar estrutura criada

## Subtarefas

### 1.1: Criar Camadas de Domínio e Aplicação

**Ação:** Criar pastas para as novas camadas arquiteturais

**Comandos:**
```bash
cd src/MathFlow

# Criar camada de domínio
mkdir -p Domain/Entities

# Criar camada de aplicação
mkdir -p Application/Services/Identity
```

**Validação:**
- [ ] Pasta `Domain/Entities` criada
- [ ] Pasta `Application/Services/Identity` criada

### 1.2: Criar Estrutura IdentityServer

**Ação:** Criar toda a estrutura de pastas para Identity Server na camada de infraestrutura

**Comandos:**
```bash
cd src/MathFlow/Infrastructure

# Criar estrutura completa do IdentityServer
mkdir -p IdentityServer/Data/Migrations
mkdir -p IdentityServer/Models
mkdir -p IdentityServer/Configuration
mkdir -p IdentityServer/Seeders
```

**Validação:**
- [ ] Pasta `Infrastructure/IdentityServer/Data/Migrations` criada
- [ ] Pasta `Infrastructure/IdentityServer/Models` criada
- [ ] Pasta `Infrastructure/IdentityServer/Configuration` criada
- [ ] Pasta `Infrastructure/IdentityServer/Seeders` criada

### 1.3: Criar Estrutura de Páginas

**Ação:** Reorganizar páginas existentes e criar estrutura para novas páginas

**Comandos:**
```bash
cd src/MathFlow/Pages

# Criar estrutura de páginas
mkdir -p Public
mkdir -p Account
mkdir -p Identity/Manage
mkdir -p Admin/Users

# Mover páginas existentes para Public
mv Index.cshtml Public/ 2>/dev/null || true
mv Index.cshtml.cs Public/ 2>/dev/null || true
mv Privacy.cshtml Public/ 2>/dev/null || true
mv Privacy.cshtml.cs Public/ 2>/dev/null || true
```

**Validação:**
- [ ] Pasta `Pages/Public` criada
- [ ] Pasta `Pages/Account` criada
- [ ] Pasta `Pages/Identity/Manage` criada
- [ ] Pasta `Pages/Admin/Users` criada
- [ ] Páginas existentes movidas para `Public/` (se aplicável)

### 1.4: Criar Estrutura de Testes

**Ação:** Criar estrutura de testes espelhando a organização de produção

**Comandos:**
```bash
cd tests

# Criar estrutura de testes unitários
mkdir -p MathFlow.UnitTests/Identity

# Criar estrutura de testes de integração
mkdir -p MathFlow.IntegrationTests/Identity
```

**Validação:**
- [ ] Pasta `tests/MathFlow.UnitTests/Identity` criada
- [ ] Pasta `tests/MathFlow.IntegrationTests/Identity` criada

### 1.5: Documentar Estrutura

**Ação:** Criar arquivo README na raiz do Identity Server explicando a organização

**Arquivo:** `src/MathFlow/Infrastructure/IdentityServer/README.md`

**Conteúdo:**
```markdown
# Identity Server

Implementação do ASP.NET Core Identity para autenticação e autorização do MathFlow.

## Estrutura

- **Data/**: DbContext e Migrations do Entity Framework Core
- **Models/**: ApplicationUser e modelos relacionados
- **Configuration/**: Configurações de Identity, OAuth e Authorization Policies
- **Seeders/**: Scripts de seed para roles e usuários iniciais

## Tecnologias

- ASP.NET Core Identity 9.0
- Entity Framework Core 9.0
- PostgreSQL 17
- Google OAuth 2.0
- TOTP (Two-Factor Authentication)

## Referências

- PRD: `tasks/prd-identity-provider/_prd.md`
- Tech Spec: `tasks/prd-identity-provider/techspec.md`
```

**Validação:**
- [ ] README.md criado e documentado

## Sequenciamento

- **Bloqueado por:** Nenhum (tarefa inicial)
- **Desbloqueia:** 2.0 (Configuração de Pacotes NuGet)
- **Paralelizável com:** Nenhum (fundação sequencial)

## Critérios de Aceitação

- [ ] Todas as pastas da estrutura criadas conforme Tech Spec
- [ ] Páginas existentes reorganizadas em `Pages/Public/`
- [ ] Estrutura de testes criada
- [ ] README.md documentando a organização
- [ ] Estrutura validada via `tree` ou `ls -R`

## Comandos de Validação

```bash
# Validar estrutura completa
cd /Users/educbank/Documents/personal_workspace/MathFlow/src/MathFlow

# Verificar Domain
ls -la Domain/Entities

# Verificar Application
ls -la Application/Services/Identity

# Verificar Infrastructure/IdentityServer
ls -la Infrastructure/IdentityServer/
ls -la Infrastructure/IdentityServer/Data/Migrations
ls -la Infrastructure/IdentityServer/Models
ls -la Infrastructure/IdentityServer/Configuration
ls -la Infrastructure/IdentityServer/Seeders

# Verificar Pages
ls -la Pages/Public
ls -la Pages/Account
ls -la Pages/Identity/Manage
ls -la Pages/Admin/Users

# Verificar Tests
ls -la ../../tests/MathFlow.UnitTests/Identity
ls -la ../../tests/MathFlow.IntegrationTests/Identity
```

## Notas de Implementação

- **Atenção**: Ao mover páginas existentes, verificar se há referências em `_ViewImports.cshtml` ou `_ViewStart.cshtml` que precisam ser atualizadas
- **Dica**: Usar `mkdir -p` garante que diretórios pais sejam criados automaticamente
- **Próximo passo**: Após conclusão, iniciar tarefa 2.0 para adicionar pacotes NuGet necessários

## Estimativa

**Tempo estimado:** 0.5 dia (4 horas)

## Riscos

- **Baixo**: Conflito com estrutura existente - Mitigação: Validar antes de mover arquivos
- **Baixo**: Quebra de referências em páginas movidas - Mitigação: Testar compilação após movimentação
